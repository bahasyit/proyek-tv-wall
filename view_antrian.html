<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Display Iklan (v3 - Carousel)</title>
    <link rel="stylesheet" href="style_iklan.css">
    
    <link rel="stylesheet" href="https://unpkg.com/swiper/swiper-bundle.min.css" />
</head>
<body>

    <div id="start-overlay">...</div>

    <div class="grid-container">
        
        <div class="grid-item jam">...</div>
        <div class="grid-item cuaca">...</div>

        <div class="grid-item iklan-kiri" id="iklan-kiri">
            <div class="swiper" id="swiper-kiri">
                <div class="swiper-wrapper" id="swiper-wrapper-kiri">
                    </div>
            </div>
        </div>

        <div class="grid-item video">...</div>
        
        <div class="grid-item iklan-kanan" id="iklan-kanan">
            <div class="swiper" id="swiper-kanan">
                <div class="swiper-wrapper" id="swiper-wrapper-kanan">
                    </div>
            </div>
        </div>
        <div class="grid-item footer">...</div>
    </div>
    
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <script src="https://www.youtube.com/iframe_api"></script>
    
    <script src="https://unpkg.com/swiper/swiper-bundle.min.js"></script>

    <script>
        // --- Bagian 1: KONFIGURASI & VARIABEL ---
        const firebaseConfig = { /* ... (Config Anda) ... */ };
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        const refAntrian = database.ref('antrian');
        const refConfig = database.ref('config');
        
        let hlsInstance = null;
        let ytPlayer = null; 
        let swiperKiri = null;  // <-- Variabel BARU
        let swiperKanan = null; // <-- Variabel BARU

        // (Semua elemen el... Anda, KECUALI elIklanKiri/Kanan)
        const elSwiperWrapperKiri = document.getElementById('swiper-wrapper-kiri');
        const elSwiperWrapperKanan = document.getElementById('swiper-wrapper-kanan');
        
        // --- Bagian 2, 3, 4 (Fungsi Jam, Cuaca, Antrian, Player) ---
        // !! TIDAK ADA PERUBAHAN SAMA SEKALI !!
        function updateClock() { /* ... kode jam lengkap ... */ }
        function fetchWeather() { /* ... kode cuaca lengkap ... */ }
        function setupAntrianListener() { /* ... kode antrian mini lengkap ... */ }
        window.onYouTubeIframeAPIReady = function() { }
        function loadYouTubePlayer(sumber, audioLevel) { /* ... kode player lengkap ... */ }
        function loadHlsPlayer(sumber, audioLevel) { /* ... kode player lengkap ... */ }

        // --- Bagian 5: FUNGSI CMS (Di-upgrade untuk Swiper) ---
        function setupConfigListener() {
            refConfig.on('value', (snapshot) => {
                const config = snapshot.val();
                if (!config) return; 
                
                if (config.marquee) { /* ... (update marquee) ... */ }
                if (config.media) { /* ... (update media) ... */ }
                
                // (BARU) Update Carousel Iklan Kiri
                if (config.iklan_kiri && config.iklan_kiri.length > 0) {
                    setupCarousel('kiri', config.iklan_kiri);
                } else {
                    destroyCarousel('kiri');
                }
                
                // (BARU) Update Carousel Iklan Kanan
                if (config.iklan_kanan && config.iklan_kanan.length > 0) {
                    setupCarousel('kanan', config.iklan_kanan);
                } else {
                    destroyCarousel('kanan');
                }
            });
        }
        
        // --- (BARU) Bagian 6: Logika Carousel Swiper.js ---
        function setupCarousel(sisi, urls) {
            let swiper = (sisi === 'kiri') ? swiperKiri : swiperKanan;
            let wrapper = (sisi === 'kiri') ? elSwiperWrapperKiri : elSwiperWrapperKanan;
            let swiperId = (sisi === 'kiri') ? '#swiper-kiri' : '#swiper-kanan';

            // 1. Hancurkan carousel lama jika ada
            if (swiper) swiper.destroy();
            
            // 2. Buat slide baru dari daftar URL
            wrapper.innerHTML = ''; // Kosongkan
            urls.forEach(url => {
                wrapper.innerHTML += `
                    <div class="swiper-slide" style="background-image: url(${url})"></div>
                `;
            });

            // 3. Inisialisasi Swiper BARU
            swiper = new Swiper(swiperId, {
                direction: 'vertical',
                loop: true,
                autoplay: {
                    delay: 5000, // Ganti slide setiap 5 detik
                    disableOnInteraction: false
                },
                effect: 'slide', // Pastikan efeknya 'slide'
            });
            
            if (sisi === 'kiri') swiperKiri = swiper;
            else swiperKanan = swiper;
        }
        function destroyCarousel(sisi) {
            let swiper = (sisi === 'kiri') ? swiperKiri : swiperKanan;
            let wrapper = (sisi === 'kiri') ? elSwiperWrapperKiri : elSwiperWrapperKanan;
            if (swiper) swiper.destroy();
            wrapper.innerHTML = '';
        }

        // --- Bagian 7: JALANKAN OTOMATIS ---
        // (Panggil semua fungsi, SAMA SEPERTI SEBELUMNYA)
        setInterval(updateClock, 1000); updateClock(); 
        fetchWeather(); setInterval(fetchWeather, 1800000); 
        setupAntrianListener();
        setupConfigListener();
    </script>
</body>
</html>